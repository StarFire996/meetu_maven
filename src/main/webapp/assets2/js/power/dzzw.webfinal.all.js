WebFinal=window.WebFinal||{name:"WebFinal",version:"1.0",iframe:true,rootPath:""};WebFinal.map={};WebFinal.backSpace=function(i){var f=i||window.event;var h=f.target||f.srcElement;var d=h.type||h.getAttribute("type");var g=h.readOnly;var c=h.disabled;g=(g==undefined)?false:g;c=(c==undefined)?true:c;var b=f.keyCode==8&&(d=="password"||d=="text"||d=="textarea")&&(g==true||c==true);var a=f.keyCode==8&&d!="password"&&d!="text"&&d!="textarea";if(a||b){event.returnValue=false}};WebFinal.getScript=function(a){$.getScript("http://10.110.1.113:8091/static/js/html5shiv.min.js").done(function(b,d,c){if("success"==d){alert("OK")}else{alert("FAIL")}})};WebFinal.restAjax=function(c,d,b){if(c.url==null){WebFinal.dialog.alert({content:"请选择输入请求的URL地址！"});return}if(c.type==null){c.type="POST"}var a=c.url;if(!a.startWith("http")){a=WebFinal.rootPath+a}if(c.data==null){c.data={}}if(c.cache==null){c.cache=false}if(c.async==null){c.async=false}$.ajax({url:a,type:c.type,data:c.data,dataType:"json",cache:c.cache,async:c.async,success:function(e){if(d&&$.isFunction(d)){d(e)}},error:function(f,h,g){if(b&&$.isFunction(b)){var e={};e.status=f.status;e.readyState=f.readyState;e.textStatus=h;b(e)}}})};WebFinal.mashupAjax=function(c,d,b){if(c.url==null){WebFinal.dialog.alert({content:"请选择输入请求的URL地址！"});return}if(c.type==null){c.type="POST"}var a=c.url;if(!a.startWith("http")){a=WebFinal.rootPath+a}if(c.data==null){c.data={}}else{c.data=$.toJSON(c.data)}if(c.cache==null){c.cache=false}if(c.async==null){c.async=false}if(c.callback==null){c.callback="callback"}$.ajax({url:a,type:c.type,data:c.data,dataType:"jsonp",cache:c.cache,async:c.async,jsonp:c.callback,success:function(e){if(d&&$.isFunction(d)){d(e)}},error:function(f,h,g){if(b&&$.isFunction(b)){var e={};e.status=f.status;e.readyState=f.readyState;e.textStatus=h;b(e)}}})};WebFinal.command=function(b,c,a){this.action=b;if(c==null){this.method="POST"}else{this.method=c}if(a==null){this.remote=false}else{this.remote=a}this.type="save";this.params={};this.returns=null};WebFinal.command.prototype={setParameter:function(a,b){this.params[a]=b},execute:function(g,e){this.type=g;if(e==null){e=true}if(this.action==null){var d={};d.state="fail";d.error="请输入处理路径！";return d}var a={};var b=this.action;if(this.remote){b=this.action+"?method="+this.type}else{b=WebFinal.rootPath+this.action+"?method="+this.type}if(this.params!=null){a=$.toJSON(this.params)}var f={type:this.method,async:!e,url:b,data:a,dataType:"json",success:function(h){if(this.target){this.target.returns=h}},error:function(i,k,j){if(this.target){var h={};h.state=0;h.message=k;this.target.returns=h;this.target.error=h.message}},target:this};$.ajax(f);if(e){if(this.returns==null){var c={};c.state=0;c.message="获取服务器端数据为空，请稍后再试！";this.returns=c;this.error=c.message}return this.returns}}};WebFinal.isSupportHtml5=function(){var a=document.createElement("canvas");return(a.getContext&&a.getContext("2d"))};WebFinal.isSupportWebSocket=function(){window.WebSocket=window.WebSocket||window.MozWebSocket;if(!window.WebSocket){return false}return true};String.prototype.endWith=function(b){var a=new RegExp(b+"$");return a.test(this)};String.prototype.startWith=function(b){var a=new RegExp("^"+b);return a.test(this)};String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")};String.prototype.IsInt=function(){if(this=="NaN"){return false}return this==parseInt(this).toString()};Date.prototype.format=function(a){var d={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours()%12==0?12:this.getHours()%12,"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};var c={"0":"\u65e5","1":"\u4e00","2":"\u4e8c","3":"\u4e09","4":"\u56db","5":"\u4e94","6":"\u516d"};if(/(y+)/.test(a)){a=a.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}if(/(E+)/.test(a)){a=a.replace(RegExp.$1,((RegExp.$1.length>1)?(RegExp.$1.length>2?"\u661f\u671f":"\u5468"):"")+c[this.getDay()+""])}for(var b in d){if(new RegExp("("+b+")").test(a)){a=a.replace(RegExp.$1,(RegExp.$1.length==1)?(d[b]):(("00"+d[b]).substr((""+d[b]).length)))}}return a};WebFinal.formatJson=function(str){var json=eval("("+str+")");return json};WebFinal.formatNumber=function(b){var a=(b*100).toString().substring(0,6);return"<font size='1'>"+a+"%</font>"};WebFinal.showDialog=function(a){var b=dialog(a);b.show()};WebFinal.modalDialog=function(a){if(a.width==null){a.width=300}var b=dialog(a);b.showModal()};WebFinal.tipDialog=function(b){b.quickClose=true;var a=b.url;if(b.iframe==null||b.iframe==false){b.url=null}var c=dialog(b);if(a!=null){if(!a.startWith("http")){a=WebFinal.rootPath+a}if(b.iframe==null||b.iframe==false){if(b.param==null){b.param={}}else{b.param=$.toJSON(b.param)}$.ajax({url:a,async:false,data:b.param,success:function(d){c.content(d)},cache:false})}}if(b.idName==null){WebFinal.dialog.alert({content:"请选择提示框的位置元素的id名称！"});return}c.show(document.getElementById(b.idName))};WebFinal.dialog=function(b){if(b.title==null){b.title="系统提示"}if(b.okValue==null){b.okValue="确定"}if(b.cancelValue==null){b.cancelValue="取消"}if(b.width==null){b.width=300}var a=b.url;if(b.iframe==null||b.iframe==false){b.url=null}var c=dialog(b);if(a!=null){if(!a.startWith("http")){a=WebFinal.rootPath+a}if(b.iframe==null||b.iframe==false){if(b.param==null){b.param={}}else{b.param=$.toJSON(b.param)}$.ajax({url:a,async:false,data:b.param,success:function(d){c.content(d)},cache:false})}}if(b.lock==true){c.showModal()}else{c.show()}return c};WebFinal.contextDialog=function(a){if(a.quickClose==null){a.quickClose=true}var b=dialog(a);if(a.idName==null){WebFinal.dialog.alert({content:"请选择提示框的位置元素的id名称！"});return}$(a.idName).on("contextmenu",function(c){b.show(c);return b.destroyed});return b};WebFinal.tips=function(a,c){var b=dialog({content:a});b.show();if(c==null){c=2000}setTimeout(function(){b.close().remove()},c)};WebFinal.dialog.alert=function(a){if(a.title==null){a.title="系统提示"}if(a.width==null){a.width=200}return WebFinal.showDialog(a)};WebFinal.dialog.alertSuccess=function(b){var a={};a.title="操作成功";a.content="<div style='padding-bottom:10px;text-align:left;'><i class='mdicon mdicon-check' style='color:green;font-size:120%;'></i>&nbsp;"+b+"</div>";a.okValue="确定";a.cancelValue="取消";a.okValue="确定";if(a.ok==null){a.ok=function(){return true}}a.cancelValue="取消";if(a.cancel){a.cancel=function(){return true}}return WebFinal.modalDialog(a)};WebFinal.dialog.alertError=function(b){var a={};a.title="操作失败";a.content="<div style='padding-bottom:10px;text-align:left;'><i class='mdicon mdicon-close' style='color:red;font-size:120%;'></i>&nbsp;"+b+"</div>";a.okValue="确定";a.cancelValue="取消";return WebFinal.modalDialog(a)};WebFinal.loadDivPage=function(e,b,c,d){var a=e;if(!(e&&e.startWith("#"))){a="#"+e}$(a).empty();$(a).load(b,c,function(){if(d&&$.isFunction(d)){d()}})};WebFinal.loadPortalPage=function(a,b,c){$("#dzzw-portal-main-content").empty();$("#dzzw-portal-main-content").css({"padding-top":"15px","overflow-y":"auto"});$("#dzzw-portal-main-content").load(a,b,function(){if(c&&$.isFunction(c)){c()}})};WebFinal.loadPortalIframe=function(a,c,f){var d="";$("#dzzw-portal-main-content").empty();if(a&&a.startWith("http")){if(a.indexOf("?")!=-1){d=a+"&v="+new Date().getTime()}else{d=a+"?v="+new Date().getTime()}$("#dzzw-portal-main-content").css("padding-top","1px")}else{d=WebFinal.rootPath+a+"?v="+new Date().getTime()}var e="<iframe id='dzzw-webfinal-iframe' height='"+($(window).height()-41)+"' width='100%' src='' allowtransparency='true' frameborder='0' scrolling='auto' seamless='seamless' marginheight='0' marginwidth='0'></iframe>";$("#dzzw-portal-main-content").html(e);var b=document.getElementById("dzzw-webfinal-iframe");b.src=d;if(b.attachEvent){b.attachEvent("onload",function(){if(f&&$.isFunction(f)){f()}})}else{b.onload=function(){if(f&&$.isFunction(f)){f()}}}};WebFinal.template=function(b,d){if(b.url==null){WebFinal.dialog.alert("请配置模板访问的URL服务地址！");return}if(b.page==null){b.page=1}if(b.rows==null){b.rows=1}if(b.param==null){b.param={}}if(d==null){d="webfinal"}var a=b.name;var c=d+"-"+a+"-template";var e=c+"-content";$.ajax({url:WebFinal.rootPath+b.url,type:"post",dataType:"json",async:false,data:$.toJSON({page:b.page,rows:b.rows,param:b.param}),success:function(g){var f=template(c,g);$("#"+e).empty();$("#"+e).html(f);if(b.callback!=null){b.callback(g)}},error:function(h,f,g){$("#"+e).html("<span style='color:red;line-height:32px;padding-left:10px;'><i class='icon-comment'></i>&nbsp;服务器忙,未读取到数据!</span>")}})};WebFinal.pageJump=function(b,f,e,c,a,d){if(c>0){if(f>=1&&f<=c){var g={};if(a.indexOf("?")!=-1){g=WebFinal.parseQueryString(a);a=a.substring(0,a.indexOf("?"))}WebFinal.template({name:b,page:f,rows:e,url:a,param:g},d)}}};WebFinal.jqPaginator=function(b,a){if(a.totalCounts==null){a.totalCounts=0}if(a.pageSize==null){a.pageSize=0}if(a.visiblePages==null){a.visiblePages=5}if(a.currentPage==null){a.currentPage=1}if(a.first==null){a.first="<li class='prev'><a href='#' onclick=WebFinal.pageJump('"+a.modelName+"',1,"+a.pageSize+",{{totalPages}},'"+a.url+"','"+a.prefix+"')>首页</a></li>"}if(a.prev==null){a.prev="<li><a href='#' onclick=WebFinal.pageJump('"+a.modelName+"',{{page}},"+a.pageSize+",{{totalPages}},'"+a.url+"','"+a.prefix+"')>上一页</a></li>"}if(a.next==null){a.next="<li><a href='#' onclick=WebFinal.pageJump('"+a.modelName+"',{{page}},"+a.pageSize+",{{totalPages}},'"+a.url+"','"+a.prefix+"')>下一页</a></li>"}if(a.last==null){a.last="<li><a href='#' onclick=WebFinal.pageJump('"+a.modelName+"',{{totalPages}},"+a.pageSize+",{{totalPages}},'"+a.url+"','"+a.prefix+"');>尾页</a></li>"}if(a.page==null){a.page="<li><a href='#' onclick=WebFinal.pageJump('"+a.modelName+"',{{page}},"+a.pageSize+",{{totalPages}},'"+a.url+"','"+a.prefix+"')>{{page}}</a></li>"}$("#"+b).jqPaginator(a)};WebFinal.submit=function(d,c,e,b){var a=false;$(d).unbind("valid.form");$(d).bind("valid.form",function(){a=true;$.ajax({url:c,type:"POST",cache:false,async:false,dataType:"json",data:$(d).serialize(),success:function(f){if(!f.error&&f.state==1){if(e&&$.isFunction(e)){e(f)}if(b&&b.success==true){WebFinal.dialog.alertSuccess(b.successMessage)}else{WebFinal.dialog.alertSuccess("恭喜您，提交数据信息成功！")}}else{if(b&&b.error==true){WebFinal.dialog.alertError(b.errorMessage)}else{WebFinal.dialog.alertError("对不起，您提交数据信息失败！")}}},error:function(f,h,g){WebFinal.dialog.alertError("对不起，您提交数据信息失败！")}})});$(d).trigger("submit");return a};WebFinal.datePicker=function(b,a){if(a==null){a={}}if(a.format==null){a.format="yyyy-mm-dd"}a.autoclose=true;a.language="zh-CN";$(b).datepicker(a)};WebFinal.parseQueryString=function(b){var g={};var a=[];var e="",f="";var d=b.substring(b.indexOf("?")+1,b.length).split("&");for(var c in d){a=d[c].split("=");e=a[0];f=a[1];g[e]=f}return g};